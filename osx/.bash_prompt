# Shell prompt based on the Solarized Dark theme.
# iTerm → Profiles → Text → use 12pt Monaco with 1.1 vertical spacing.

if [ -f ~/git-prompt.sh ]; then
    source ~/git-prompt.sh
    GIT_PS1_SHOWDIRTYSTATE=1
    GIT_PS1_SHOWUNTRACKEDFILES=1
    GIT_PS1_SHOWUPSTREAM="auto"
else
    function __git_ps1 {
        return
    }
fi

if tput setaf 1 &> /dev/null; then
	tput sgr0; # reset colors
	BOLD=$(tput bold);
	COLOR_RESET=$(tput sgr0);
	# Solarized colors, taken from http://git.io/solarized-colors.
	BLACK=$(tput setaf 0);
	RED=$(tput setaf 124);
	RED_BOLD="$BOLD$RED";
	GREEN=$(tput setaf 64);
	GREEN_BOLD="$BOLD$GREEN";
	YELLOW=$(tput setaf 136);
	YELLOW_BOLD="$BOLD$YELLOW";
	BLUE=$(tput setaf 33);
	BLUE_BOLD="$BOLD$BLUE";
	PURPLE=$(tput setaf 125);
	PURPLE_BOLD="$BOLD$PURPLE";
	CYAN=$(tput setaf 37);
	CYAN_BOLD="$BOLD$CYAN";
	WHITE=$(tput setaf 15);
	WHITE_BOLD="$BOLD$WHITE";
	ORANGE=$(tput setaf 166);
	ORANGE_BOLD="$BOLD$ORANGE";
	VIOLET=$(tput setaf 61);
	VIOLET_BOLD="$BOLD$VIOLET";
else
	COLOR_RESET='\[\e[0m\]'
	NO_COLOUR="\[\033[0m\]"
	BLACK="\[\033[0;30m\]"
	RED="\[\033[0;31m\]"
	RED_BOLD="\[\033[01;31m\]"
	GREEN="\[\033[0;32m\]"
	GREEN_BOLD="\[\033[01;32m\]"
	YELLOW="\[\033[0;33m\]"
	YELLOW_BOLD="\[\033[01;33m\]"
	BLUE="\[\033[0;34m\]"
	BLUE_BOLD="\[\033[01;34m\]"
	PURPLE='\[\e[0;35m\]'
	PURPLE_BOLD='\[\e[01;35m\]'
	CYAN='\[\e[0;36m\]'
	CYAN_BOLD='\[\e[01;36m\]'
	WHITE='\[\e[0;37m\]'
	WHITE_BOLD='\[\e[01;37m\]'
fi;

function precmd {
    local separator=' : '
    local user="${USER} @ ${HOSTNAME}"
    # if [ -z "$SSH_CLIENT" ] && [ -z "$SSH_TTY" ]; then
    #     user="$user (local)"
    # fi
    local location="${PWD}"

    local prefix="\n${YELLOW_BOLD}${user}${COLOR_RESET}${separator}${GREEN_BOLD}${location}${COLOR_RESET}${BLUE_BOLD}$(__git_ps1 " (%s)")${COLOR_RESET}"

    local title="${user}${separator}${location}$(__git_ps1 " (%s)")"
    echo -ne "\033]0;${title}\007"
    export PS1="${prefix}\n\$ "
}

export PROMPT_COMMAND=precmd
